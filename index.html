<!DOCTYPE html>
<!-- 
    Roger's AI Assistant - Enterprise Edition
    Version: 21.4 (Link Correction)
    
    Changelog:
    - [Fix] Corrected the Japanese "Resume" (å±¥æ­´æ›¸) link to the specific version requested.
    - [Content] "Shokumu Keireki" (è·å‹™çµŒæ­´æ›¸) link remains unchanged.
    - [Security] Retained all previous security features (Honeypot, Rate Limiting, Sanitization).
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Roger's AI Assistant | Enterprise Connect</title>
    <style>
        /* * CORE VARIABLES & RESET
         * Updated palette: Turquoise background + Gold accents
         */
        :root {
            --bg-gradient-top: #00CEC8;
            --bg-gradient-bottom: #00a6a2;
            
            --header-gradient-start: #4a5568; /* Dark Slate */
            --header-gradient-end: #2d3748;   /* Darker Slate */
            --primary-blue: #4299e1;
            --primary-blue-dark: #3182ce;
            --text-dark: #2d3748;
            --text-light: #718096;
            --shadow-soft: 0 10px 40px rgba(0,0,0,0.15);
            --radius-lg: 20px;
            --radius-md: 12px;
            
            /* Gold Colors for Avatar */
            --gold-shiny: #FFD700;
            --gold-glow: rgba(255, 215, 0, 0.6);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            cursor: none; /* Hide default cursor globally */
        }

        /* UPDATED FOR FULL SCREEN LAYOUT */
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(180deg, var(--bg-gradient-top) 0%, var(--bg-gradient-bottom) 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center; /* Keeps language screen centered */
            align-items: center;
            margin: 0;
            padding: 0; /* REMOVED PADDING for full screen */
            color: var(--text-dark);
            overflow: hidden; /* Prevent body scroll, handle in chat container */
            
            /* PARALLAX SETUP */
            background-size: 120% 120%;
            background-position: 50% 50%;
            transition: background-position 0.3s ease;
        }

        /* ---------------------------------------------------------
           DYNAMIC CURSOR STYLES
           --------------------------------------------------------- */
        .cursor-dot,
        .cursor-outline {
            position: fixed;
            top: 0;
            left: 0;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            z-index: 9999;
            pointer-events: none; /* Crucial: allows clicking through */
            transition: opacity 0.3s ease, transform 0.1s ease; /* Smooth fades */
        }

        .cursor-dot {
            width: 8px;
            height: 8px;
            background-color: var(--text-dark); 
            box-shadow: 0 0 4px rgba(255, 255, 255, 0.4);
        }

        .cursor-outline {
            width: 40px;
            height: 40px;
            border: 1px solid rgba(45, 55, 72, 0.5); 
            transition: width 0.2s, height 0.2s, background-color 0.2s, border-color 0.2s; 
        }

        @keyframes cursorRipple {
            0% { transform: translate(-50%, -50%) scale(1); opacity: 0.5; }
            100% { transform: translate(-50%, -50%) scale(2); opacity: 0; }
        }

        .cursor-outline.clicking {
            animation: cursorRipple 0.4s ease-out;
        }

        body.hovering .cursor-outline {
            width: 60px;
            height: 60px;
            background-color: rgba(45, 55, 72, 0.08); 
            border-color: transparent;
        }
        
        body.hovering .cursor-dot {
            opacity: 0.5;
        }

        iframe {
            cursor: auto !important;
        }

        @media (hover: none) and (pointer: coarse) {
            .cursor-dot, .cursor-outline {
                display: none !important;
            }
            * {
                cursor: auto !important;
            }
        }

        /* ---------------------------------------------------------
           COMPONENT STYLES
           --------------------------------------------------------- */

        /* Language Selection - Centered Card */
        .language-selection-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 90%;
            max-width: 450px;
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-soft);
            padding: 40px 30px;
            text-align: center;
            animation: fadeInUp 0.6s ease-out;
            z-index: 10;
        }

        .language-selection-screen h1 {
            font-size: 1.5rem;
            color: var(--text-dark);
            margin-bottom: 35px;
            font-weight: 700;
            line-height: 1.4;
        }

        .language-button {
            padding: 16px 0;
            margin: 8px 0;
            width: 100%;
            border: 1px solid #e2e8f0;
            background: white;
            color: var(--text-dark);
            border-radius: var(--radius-md);
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .language-button:hover {
            background: #f7fafc;
            border-color: #32cd32; /* Lime accent */
            transform: translateY(-2px);
            box-shadow: 0 0 20px rgba(50, 205, 50, 0.5); /* Lime Green Glow */
        }

        /* * COMPONENT: CHAT CONTAINER
         * UPDATED: Full Screen Logic
         */
        .chat-container {
            width: 100vw; /* Full viewport width */
            height: 100vh; /* Full viewport height */
            max-width: 100%;
            max-height: 100vh;
            background: white;
            border-radius: 0; /* Remove rounded corners for full-screen */
            box-shadow: none;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            display: none; /* Initially hidden */
            position: relative;
        }

        /* * COMPONENT: HEADER */
        .chat-header {
            background: linear-gradient(135deg, var(--header-gradient-start), var(--header-gradient-end));
            color: white;
            padding: 15px 20px; /* Slightly tighter padding for full screen header */
            text-align: center;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 15px;
        }

        /* UPDATED: Profile Container with Gold Pulse */
        .profile-container {
            width: 50px; /* Smaller avatar for header bar style */
            height: 50px;
            border-radius: 50%;
            border: 2px solid var(--gold-shiny);
            padding: 2px; 
            position: relative;
            flex-shrink: 0;
            /* Animation for the glow */
            animation: goldPulse 3s infinite ease-in-out;
        }

        .profile-media {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            overflow: hidden;
            background: #000;
            position: relative;
        }

        .profile-media video, 
        .profile-media img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .header-text {
            text-align: left;
        }

        .chat-title {
            font-size: 1.1rem;
            font-weight: 600;
            letter-spacing: 0.5px;
            line-height: 1.2;
        }

        .chat-subtitle {
            font-size: 0.8rem;
            opacity: 0.8;
            font-weight: 400;
        }

        /* * COMPONENT: MESSAGES */
        .chat-messages {
            flex: 1;
            padding: 20px 20px 40px 20px; /* Extra bottom padding */
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 16px;
            background-color: #fff;
            scroll-behavior: smooth;
            max-width: 900px; /* Constrain reading width for better UX on large screens */
            width: 100%;
            margin: 0 auto; /* Center the message column */
        }

        .message {
            max-width: 85%;
            padding: 14px 18px;
            border-radius: 18px;
            font-size: 1rem; /* Slightly larger for readability */
            line-height: 1.6;
            position: relative;
            animation: messageSlide 0.3s ease-out;
            white-space: pre-wrap;
        }

        .message.bot {
            background: #f1f5f9;
            color: var(--text-dark);
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }

        .message.user {
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-blue-dark));
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
            box-shadow: 0 2px 5px rgba(66, 153, 225, 0.3);
        }

        .message-time {
            font-size: 0.7rem;
            margin-top: 6px;
            opacity: 0.6;
            display: block;
        }
        .message.user .message-time { text-align: right; color: rgba(255,255,255,0.9); }

        /* * COMPONENT: INPUT AREA & QUICK REPLIES */
        .chat-input-container {
            padding: 20px;
            border-top: 1px solid #edf2f7;
            background: white;
            width: 100%;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center; /* Center content */
        }

        .input-width-constraint {
            width: 100%;
            max-width: 900px; /* Match message width constraint */
        }

        /* Grid Layout for Buttons */
        .quick-replies {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
            width: 100%;
        }

        .quick-reply {
            padding: 12px 10px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            border: 1px solid transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        .quick-reply.primary { background: linear-gradient(135deg, var(--primary-blue), var(--primary-blue-dark)); color: white; border: none; }
        .quick-reply.secondary { background: white; border: 1px solid var(--primary-blue); color: var(--primary-blue); }
        .quick-reply.neutral { background: #edf2f7; color: var(--text-light); border: 1px solid #e2e8f0; }

        .quick-reply:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 0 15px rgba(50, 205, 50, 0.6); /* Lime Green Glow */
            border-color: #32cd32;
        }

        /* UPDATED: Input Field Wrapper with Fixed Shrinking */
        .input-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 30px;
            padding: 5px 5px 5px 20px;
            transition: border-color 0.2s;
            width: 100%;
            box-sizing: border-box;
            min-height: 54px; /* Fix A: Prevents collapse */
        }

        .input-wrapper:focus-within {
            border-color: var(--primary-blue);
            background: white;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
        }

        .chat-input {
            flex: 1;
            border: none;
            background: transparent;
            font-size: 1rem;
            padding: 10px 0;
            outline: none;
            resize: none;
            max-height: 120px;
            font-family: inherit;
            width: 100%;
            min-height: 34px; /* Fix A: Ensures minimum size for text */
        }

        .send-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--primary-blue);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s, background 0.2s;
            flex-shrink: 0;
        }

        .send-btn:hover { 
            background: var(--primary-blue-dark); 
            transform: scale(1.05); 
            box-shadow: 0 0 10px rgba(50, 205, 50, 0.6); /* Lime Green Glow */
        }
        .send-btn:disabled { background: #cbd5e0; cursor: not-allowed; }

        /* * FORMS & UTILITIES */
        .message-form { padding: 20px; overflow-y: auto; background: #fff; width: 100%; max-width: 900px; margin: 0 auto; }
        .form-group { margin-bottom: 15px; }
        .form-label { display: block; margin-bottom: 6px; font-size: 0.85rem; font-weight: 600; color: var(--text-dark); }
        .form-input { width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 0.95rem; font-family: inherit; transition: border 0.2s; }
        .form-input:focus { border-color: var(--primary-blue); outline: none; }
        
        .btn-block { width: 100%; padding: 12px; border-radius: 8px; font-weight: 600; cursor: pointer; border: none; transition: transform 0.1s; }
        .btn-primary { background: linear-gradient(135deg, var(--primary-blue), var(--primary-blue-dark)); color: white; }

        /* Typing Indicator */
        .typing-indicator {
            padding: 15px; background: #f1f5f9; border-radius: 18px; border-bottom-left-radius: 4px;
            width: fit-content; margin-bottom: 15px; display: none;
        }
        .dots { display: flex; gap: 4px; }
        .dot { width: 8px; height: 8px; background: #cbd5e0; border-radius: 50%; animation: bounce 1.4s infinite ease-in-out both; }
        .dot:nth-child(1) { animation-delay: -0.32s; }
        .dot:nth-child(2) { animation-delay: -0.16s; }

        /* Resume Embed */
        .resume-frame { width: 100%; height: 600px; border: 1px solid #e2e8f0; border-radius: 8px; margin-top: 10px; background: #f8f9fa; }

        /* Utility Classes */
        .hidden { display: none !important; }
        .fade-in { animation: fadeInUp 0.4s ease-out; }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .quick-replies { grid-template-columns: 1fr; gap: 8px; }
            .quick-reply { padding: 14px; font-size: 1rem; }
            .message { max-width: 90%; }
            .chat-messages { padding: 15px; }
        }

        /* Keyframes */
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes messageSlide { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }

        /* UPDATED: Gold Pulse Keyframes */
        @keyframes goldPulse {
            0% {
                box-shadow: 0 0 5px rgba(255, 215, 0, 0.3);
                border-color: #dbb904; /* Darker gold */
                transform: scale(1);
            }
            50% {
                box-shadow: 0 0 25px rgba(255, 215, 0, 0.8); /* Strong glow */
                border-color: #ffe34d; /* Brighter gold */
                transform: scale(1.02);
            }
            100% {
                box-shadow: 0 0 5px rgba(255, 215, 0, 0.3);
                border-color: #dbb904;
                transform: scale(1);
            }
        }

        .profile-container:hover {
            transform: scale(1.08);
            transition: transform 0.3s ease;
            animation: none; /* Pause pulsing on hover */
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.9);
            border-color: #ffe34d;
        }
    </style>
</head>
<body>

    <!-- Dynamic Cursor Elements -->
    <div class="cursor-dot" id="cursorDot"></div>
    <div class="cursor-outline" id="cursorOutline"></div>

    <!-- Language Selection Screen -->
    <div class="language-selection-screen" id="languageSelectionScreen">
        <h1>Select Language<br><span style="font-size: 0.8em; font-weight: normal; color: #718096;">è¨€èªã‚’é¸æŠã—ã¦ãã ã•ã„</span></h1>
        <button class="language-button" onclick="app.setLanguage('en')">
            <span>ğŸ‡ºğŸ‡¸</span> English
        </button>
        <button class="language-button" onclick="app.setLanguage('ja')">
            <span>ğŸ‡¯ğŸ‡µ</span> æ—¥æœ¬èª
        </button>
    </div>

    <!-- Main Chat Application (Full Screen) -->
    <div class="chat-container" id="chatContainer">
        
        <!-- Header -->
        <div class="chat-header">
            <div class="profile-container">
                <div class="profile-media">
                    <video 
                        id="avatarVideo"
                        class="avatar-video"
                        src="https://gomesroger.github.io/roger-ai-assets/New_Avatar_Of_Roger.webm" 
                        autoplay loop muted playsinline
                        poster="https://i.imgur.com/ThRrtS2.jpeg"
                        onerror="this.style.display='none'; document.getElementById('avatarFallback').style.display='block';">
                    </video>
                    <img id="avatarFallback" src="https://i.imgur.com/ThRrtS2.jpeg" alt="Roger Gomes" 
                         style="display: none; width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                </div>
            </div>
            <div class="header-text">
                <div class="chat-title">Roger's AI Assistant</div>
                <div class="chat-subtitle">Enterprise Connect</div>
            </div>
        </div>

        <!-- Chat History Area -->
        <div class="chat-messages" id="chatMessages">
            <!-- Messages injected via JS -->
        </div>

        <!-- Typing Indicator -->
        <div style="max-width: 900px; width: 100%; margin: 0 auto; padding: 0 20px;">
            <div class="typing-indicator" id="typingIndicator">
                <div class="dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
            </div>
        </div>

        <!-- Input Area & Quick Replies -->
        <div class="chat-input-container" id="inputArea">
            <div class="input-width-constraint">
                <!-- Grid Buttons -->
                <div class="quick-replies hidden" id="quickReplies"></div>
                
                <!-- Text Input -->
                <div class="input-wrapper">
                    <textarea id="chatInput" class="chat-input" rows="1" placeholder="Type a message..."></textarea>
                    <button id="sendBtn" class="send-btn">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Contact Form (Overlay style) -->
        <div class="message-form hidden" id="contactForm">
            <!-- Honeypot Field for Bot Trapping -->
            <div style="position: absolute; left: -5000px;" aria-hidden="true">
                <input type="text" id="website" name="website" tabindex="-1" autocomplete="off">
            </div>

            <div class="form-group">
                <label class="form-label" id="lbl_name">Name</label>
                <input type="text" class="form-input" id="f_name">
            </div>
            <div class="form-group">
                <label class="form-label" id="lbl_company">Company</label>
                <input type="text" class="form-input" id="f_company">
            </div>
            <div class="form-group">
                <label class="form-label" id="lbl_email">Email</label>
                <input type="email" class="form-input" id="f_email">
            </div>
            <div class="form-group">
                <label class="form-label" id="lbl_msg">Message</label>
                <textarea class="form-input" id="f_message" rows="4"></textarea>
            </div>
            <div>
                <button class="btn-block btn-primary" id="btn_send" onclick="app.submitForm()">Send Message</button>
            </div>
            <div id="formStatus" style="margin-top: 10px; text-align: center; font-size: 0.85rem; color: green;"></div>
        </div>

        <!-- Rating Section -->
        <div id="ratingSection" class="chat-input-container hidden" style="text-align: center;">
            <p style="margin-bottom: 10px; color: var(--text-light);">How was your experience?</p>
            <div style="font-size: 2rem; cursor: pointer;" id="stars">
                <span data-val="1">â˜…</span><span data-val="2">â˜…</span><span data-val="3">â˜…</span><span data-val="4">â˜…</span><span data-val="5">â˜…</span>
            </div>
        </div>
        
        <!-- Creator Signature -->
        <div style="text-align: center; padding: 10px; font-size: 0.75rem; color: #a0aec0; background: white;">
            Built by <a href="https://www.linkedin.com/in/meetrogergomes" target="_blank" style="color: #4299e1; text-decoration: none;">Roger Gomes</a> â€¢ v21.4
        </div>

    </div>

    <!-- APPLICATION LOGIC -->
    <script>
        const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw5Bzae7b5FXEYF_XKVO3udqZADIx3ez35p3TTsdxPnRfSdBwb8weQgbPm-kEegHihdTw/exec';
        
        const RESOURCES = {
            en: {
                welcome: "Hello! I'm Roger's AI Assistant. I'm here to help you connect with Roger efficiently.",
                menuPrompt: "How can I help you today?",
                
                summary: `
<strong style="font-size: 1.1em; color: #2d3748;">Professional Overview</strong><br><br>
â— Strategic GTM leader with 20+ years in B2B, SaaS, AI, and startup growth across APAC & North America.<br><br>
â— Led $295M+ total portfolio spanning retail operations and enterprise deals.<br><br>
â— Currently building <a href="https://kaptureapp.io" target="_blank" style="color: #4299e1; text-decoration: none;">KAPTURE APP</a>, an AI recruitment platform reducing hiring time by 85%.<br><br>
<strong style="color: #4299e1;">What I'm Looking For</strong><br>
<strong>Primary Focus:</strong> Executive operating roles at Series A-C B2B SaaS or AI startups scaling globally. I want to partner with founding teams, taking ownership of GTM strategy, revenue operations, and building scalable systems from the ground up.<br><br>
<strong>Also Open To:</strong> Strategic consulting or fractional leadership engagements (6-12 month mandates) for companies navigating:<br>
- Digital transformation and operational excellence initiatives<br>
- RevOps framework design and CRM/automation stack implementation<br>
- Cross-regional expansion (particularly Global â†’ APAC expansion, or Japan â†’ Global market entry)<br>
- 0â†’1 product launches requiring interim operational leadership<br><br>
<strong>Motivated by:</strong> High-impact challenges, operational autonomy, meaningful equity participation, and collaborative founding teams that value execution speed over consensus-building.<br><br>
<strong style="color: #4299e1;">Core Strengths</strong><br>
â—ˆ <em>Systems Thinker:</em> I build scalable frameworks that turn chaos into predictable growth.<br>
â—ˆ <em>Execution Speed:</em> From custom AI assistants to $80M international initiatives, I turn strategy into reality fast.<br>
â—ˆ <em>Data-Driven Pragmatist:</em> CRM adoption +30%, NPS +15%, churn -17%.<br><br>
<em style="color: #718096;">Want to explore how I can accelerate your company's growth? Let's schedule a conversation.</em>
                `,
                
                schedule: "Excellent choice. I've opened Roger's calendar. Please pick a time that works for you.",
                resume: "Here is Roger's current resume.",
                linkedin: "You can connect with Roger directly on LinkedIn here: <a href='https://www.linkedin.com/in/meetrogergomes' target='_blank' style='color: #3182ce;'>linkedin.com/in/meetrogergomes</a>",
                formIntro: "Please fill out the details below to leave a message.",
                thanks: "Thank you! Your message has been sent successfully.",
                error: "Something went wrong. Please try again.",
                ui: {
                    title: "Roger's AI Assistant",
                    subtitle: "Enterprise Connect",
                    placeholder: "Type your message...",
                    buttons: ["Schedule a chat", "Leave a message", "Professional Summary", "View Resume", "Connect on LinkedIn", "Exit"],
                    form: { name: "Your Name", company: "Company", email: "Email", msg: "Message", send: "Send Message" }
                },
                
                // --- DEEP DIVE RESOURCES (ENGLISH) ---
                industryDisclaimer: "Quick note: I specialize in B2B SaaS and tech startups (Seed to Series C). My playbooks are built for scaling tech operations. If that's not your world, this might not be the best fit.",
                
                deepDiveIntro: "I'd love to create a custom 90-day playbook for your top operational bottlenecks. Here's how this works:\n\nâ˜‘ I personally craft every playbook (no AI templates)\nâ˜‘ Timeline: 48-72 hours via email\nâ˜‘ Focus: Your top 3 bottlenecks (we'll prioritize together)\nâ˜‘ What you get: Strategic roadmap + implementation framework\n\nâš ï¸ Important: This will be directional guidance on your bottlenecksâ€”not a complete playbook. If I gave away full implementation plans for free, why would anyone hire me, right? Think of this as a strategic consultation preview.\n\nThis isn't instant AIâ€”it's strategic thinking. Worth the wait?\n\nMind if I ask 3-5 follow-up questions to understand your context?",
                
                deepDiveAccept: "Great! Let's start with a few questions. This should take about 3 minutes.",
                deepDiveSkip: "No problem! I'll work with what you've shared so far.",
                priorityRankingQuestion: "Last question: If you had to rank your operational issues by urgency, which ONE is costing you the most right nowâ€”in terms of revenue, time, or team morale?",
                priorityPlaceholder: 'Example: "Conversionâ€”we\'re losing deals we should be winning"',
                diagnosticComplete: "Perfect! I now have a complete picture of your situation. I'll personally analyze this and craft a detailed playbook covering:\n\nâ€¢ Week 1-2: Diagnostic\nâ€¢ Week 3-6: Quick Wins\nâ€¢ Week 7-12: Strategic Initiatives\n\nI'll email this to you within 48-72 hours. What's your email address?",
                diagnosticConfirm: "Got it! I'll send your custom playbook to {email} within 48-72 hours.",
                acknowledgments: ['Got it.', 'Understood.', 'Makes sense.', "That's helpful context.", 'Interestingâ€”thanks for sharing.'],
                diagnosticQuestions: {
                    'Operations': [
                        { id: 'ops_1', q: "What's the #1 manual task your team wishes was automated?", type: 'freeText', placeholder: 'Example: "Copying data between our CRM and billing system"', followUps: { 'data entry': "Got it. Is this happening in your CRM, spreadsheets, or somewhere else?", 'reporting': "Makes sense. How long does it currently take to generate reports?", 'coordination': "Interesting. Which teams struggle most to stay aligned?", 'default': "Understood. What tools are you currently using for this?" } },
                        { id: 'ops_2', q: "When things go wrong operationally, where's the breakdown usually happening?", type: 'options', options: ["Unclear ownership", "Tool limitations", "Communication gaps", "Process isn't documented"] },
                        { id: 'ops_3', q: "If you could fix ONE operational issue tomorrow, what would have the biggest impact on your team's productivity?", type: 'freeText', placeholder: 'Example: "Eliminating our weekly manual reconciliation process"' }
                    ],
                    'Conversion': [
                        { id: 'conv_1', q: "Where in your sales process do most leads drop off?", type: 'options', options: ["Initial call/demo", "Proposal/pricing stage", "Contract/legal", "They ghost after demo"] },
                        { id: 'conv_2', q: "What's the most common objection your sales team hears?", type: 'freeText', placeholder: 'Example: "Too expensive compared to competitors"', followUps: { 'price': "Got it. How does your pricing actually compare to competitors?", 'timing': "Interesting. What's usually driving the 'not now' responseâ€”budget cycles? Other priorities?", 'value': "That's helpful. Do prospects clearly understand your ROI, or is that part of the problem?", 'default': "Understood. How is your team currently handling that objection?" } },
                        { id: 'conv_3', q: "What does your best-converting sales rep do differently than everyone else?", type: 'freeText', placeholder: 'Example: "She sends custom ROI calculators before the demo"' }
                    ],
                    'Churn': [
                        { id: 'churn_1', q: "At what point in the customer journey do most cancellations happen?", type: 'options', options: ["First 30 days (onboarding)", "90-180 days (post-launch)", "At renewal", "After a support issue"] },
                        { id: 'churn_2', q: "When you ask churned customers why they left, what's the #1 reason they give?", type: 'freeText', placeholder: 'Example: "Didn\'t see enough value to justify the cost"', followUps: { 'didn\'t use': "That's common. Did they struggle with adoption, or did the use case just disappear?", 'expensive': "Interesting. Was this about budget cuts, or did they not see enough ROI?", 'competitor': "Got it. What did the competitor offer that you didn't?", 'default': "Understood. What do your happiest customers say when you ask why they stay?" } },
                        { id: 'churn_3', q: "What's ONE thing your most successful customers all have in common?", type: 'freeText', placeholder: 'Example: "They have a dedicated champion who drives adoption"' }
                    ],
                    'Velocity': [
                        { id: 'vel_1', q: "What typically causes deals to stall in your pipeline?", type: 'options', options: ["æ³•å‹™/èª¿é”å¾…ã¡", "è¤‡æ•°ã®ã‚¹ãƒ†ãƒ¼ã‚¯ãƒ›ãƒ«ãƒ€ãƒ¼ã®èª¿æ•´ä¸è¶³", "å®Ÿè£…ã¸ã®æ‡¸å¿µ", "äºˆç®—æ‰¿èªã®é…å»¶"] },
                        { id: 'vel_2', q: "æœ€åˆã®æ¥è§¦ã‹ã‚‰ã‚¯ãƒ­ãƒ¼ã‚ºã¾ã§ã€å¹³å‡ã§ã©ã®ãã‚‰ã„ã®æœŸé–“ãŒã‹ã‹ã‚Šã¾ã™ã‹?", type: 'freeText', placeholder: 'ä¾‹:ã€Œç´„90æ—¥ã§ã™ãŒã€45æ—¥ã«è¿‘ã¥ã‘ãŸã„ã€', followUps: { '3': "æ‰¿çŸ¥ã—ã¾ã—ãŸã€‚é…å»¶ã¯å¾¡ç¤¾å´(å–¶æ¥­ãƒ—ãƒ­ã‚»ã‚¹)ã§ã™ã‹ã€ãã‚Œã¨ã‚‚é¡§å®¢å´(è³¼è²·ãƒ—ãƒ­ã‚»ã‚¹)ã§ã™ã‹?", '6': "ç†è§£ã—ã¾ã—ãŸã€‚ä¸€è²«ã—ã¦é•·å¼•ãç‰¹å®šã®æ®µéšã¯ã‚ã‚Šã¾ã™ã‹?", '9': "ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã¨ã—ã¦ç†è§£ã§ãã¾ã™ã€‚ãã®æœŸé–“ã‚’åŠåˆ†ã«ã™ã‚‹ã«ã¯ä½•ã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã‹?", 'default': "å‚è€ƒã«ãªã‚Šã¾ã™ã€‚ãã‚Œã‚’é€Ÿã‚ã‚‹ã«ã¯ä½•ã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã‹?" } },
                        { id: 'vel_3', q: "å–¶æ¥­ãƒ—ãƒ­ã‚»ã‚¹ã‹ã‚‰1ã¤ã®æ‘©æ“¦ç‚¹ã‚’å–ã‚Šé™¤ã‘ã‚‹ã¨ã—ãŸã‚‰ã€ä½•ãŒå³åº§ã«ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—ã—ã¾ã™ã‹?", type: 'freeText', placeholder: 'ä¾‹:ã€Œæ³•å‹™ãƒ¬ãƒ“ãƒ¥ãƒ¼å‰ã«æŠ€è¡“æ¤œè¨¼ã‚’å®Œäº†ã™ã‚‹ã€' }
                    ]
                }
            },
            ja: {
                welcome: "ã“ã‚“ã«ã¡ã¯ï¼ãƒ­ã‚¸ãƒ£ãƒ¼ã®AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚ãƒ­ã‚¸ãƒ£ãƒ¼ã¨ã®é€£çµ¡ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚",
                menuPrompt: "æœ¬æ—¥ã¯ã©ã®ã‚ˆã†ãªã”ç”¨ä»¶ã§ã—ã‚‡ã†ã‹ï¼Ÿ",
                
                // UPDATED: Japanese summary details
                summary: `
<strong style="font-size: 1.1em; color: #2d3748;">ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ã¨ã—ã¦ã®æ¦‚è¦</strong><br><br>
â— æˆ¦ç•¥çš„GTMãƒªãƒ¼ãƒ€ãƒ¼ã¨ã—ã¦ã€APACãŠã‚ˆã³åŒ—ç±³ã«ãŠã‘ã‚‹B2Bã€SaaSã€AIã€ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—æˆé•·é ˜åŸŸã§20å¹´ä»¥ä¸Šã®çµŒé¨“ã‚’æœ‰ã—ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«å±•é–‹ã¨äº‹æ¥­æ‹¡å¤§ã‚’æ¨é€²ã—ã¦ãã¾ã—ãŸã€‚<br><br>
â— å°å£²é‹å–¶ã‹ã‚‰ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºæ¡ˆä»¶ã¾ã§ç·é¡2å„„9500ä¸‡ãƒ‰ãƒ«ä»¥ä¸Šã®ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã‚’çµ±æ‹¬ã€‚<br><br>
â— ç¾åœ¨ã€æ¡ç”¨æœŸé–“ã‚’85%çŸ­ç¸®ã™ã‚‹AIæ¡ç”¨ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã€Œ<a href="https://kaptureapp.jp" target="_blank" style="color: #4299e1; text-decoration: none;">KAPTURE APP</a>ã€ã‚’é–‹ç™ºä¸­ã§ã™ã€‚<br><br>
<strong style="color: #4299e1;">æ±‚ã‚ã¦ã„ã‚‹å½¹å‰²</strong><br>
<strong>ä¸»ãªå¸Œæœ›:</strong> ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«äº‹æ¥­æ‹¡å¤§ã‚’ç›®æŒ‡ã™ã‚·ãƒªãƒ¼ã‚ºAã€œCæ®µéšã®B2B SaaSã¾ãŸã¯AIã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã«ãŠã‘ã‚‹çµŒå–¶å¹¹éƒ¨è·ã€‚å‰µæ¥­ãƒãƒ¼ãƒ ã¨ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚·ãƒƒãƒ—ã‚’çµ„ã¿ã€GTMæˆ¦ç•¥ã€ãƒ¬ãƒ™ãƒ‹ãƒ¥ãƒ¼ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ãªã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰ã‚’ä¸»å°ã—ãŸã„ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚<br><br>
<strong>ä½µã›ã¦æ¤œè¨å¯èƒ½:</strong> ä»¥ä¸‹ã®é ˜åŸŸã«ãŠã‘ã‚‹æˆ¦ç•¥ã‚³ãƒ³ã‚µãƒ«ãƒ†ã‚£ãƒ³ã‚°ã¾ãŸã¯ãƒ•ãƒ©ã‚¯ã‚·ãƒ§ãƒŠãƒ«ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ï¼ˆ6ã€œ12ãƒ¶æœˆå¥‘ç´„ï¼‰:<br>
- ãƒ‡ã‚¸ã‚¿ãƒ«ãƒˆãƒ©ãƒ³ã‚¹ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŠã‚ˆã³ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ”¹å–„ã‚¤ãƒ‹ã‚·ã‚¢ãƒ†ã‚£ãƒ–<br>
- RevOpsãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯è¨­è¨ˆãŠã‚ˆã³CRM/è‡ªå‹•åŒ–ã‚¹ã‚¿ãƒƒã‚¯å®Ÿè£…<br>
- ã‚¯ãƒ­ã‚¹ãƒªãƒ¼ã‚¸ãƒ§ãƒŠãƒ«å±•é–‹ï¼ˆç‰¹ã«ã‚°ãƒ­ãƒ¼ãƒãƒ«â†’APACå±•é–‹ã€ã¾ãŸã¯æ—¥æœ¬â†’ã‚°ãƒ­ãƒ¼ãƒãƒ«å¸‚å ´å‚å…¥ï¼‰<br>
- 0â†’1ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãƒ­ãƒ¼ãƒ³ãƒã«ãŠã‘ã‚‹æš«å®šçš„ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—<br><br>
<strong>é‡è¦–ã™ã‚‹è¦ç´ :</strong> é«˜ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆãªèª²é¡Œã€ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä¸Šã®è£é‡æ¨©ã€æ„ç¾©ã‚ã‚‹ã‚¨ã‚¯ã‚¤ãƒ†ã‚£å‚åŠ ã€ã‚³ãƒ³ã‚»ãƒ³ã‚µã‚¹é‡è¦–ã‚ˆã‚Šã‚‚å®Ÿè¡Œã‚¹ãƒ”ãƒ¼ãƒ‰ã‚’å„ªå…ˆã™ã‚‹å‰µæ¥­ãƒãƒ¼ãƒ ã¨ã®å”åƒã€‚<br><br>
<strong style="color: #4299e1;">ã‚³ã‚¢ãƒ»ã‚¹ãƒˆãƒ¬ãƒ³ã‚°ã‚¹ï¼ˆå¼·ã¿ï¼‰</strong><br>
â—ˆ <em>ã‚·ã‚¹ãƒ†ãƒ æ€è€ƒ:</em> ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æ¬ é™¥ã§ã‚ã‚Œå¸‚å ´æ©Ÿä¼šã§ã‚ã‚Œã€ä»–ã®äººãŒè¦‹é€ƒã™ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¦‹ã¤ã‘å‡ºã—ã¾ã™ã€‚<br>
â—ˆ <em>å®Ÿè¡Œã‚¹ãƒ”ãƒ¼ãƒ‰:</em> è­°è«–ã‚ˆã‚Šã‚‚ã€Œå‡ºè·ï¼ˆå®Ÿè¡Œï¼‰ã€ã‚’é‡è¦–ã—ã¾ã™ã€‚<br>
â—ˆ <em>ãƒ‡ãƒ¼ã‚¿ä¸»å°ã®å®Ÿåˆ©ä¸»ç¾©:</em> CRMå°å…¥ç‡+30%ã€NPS+15%ã€è§£ç´„ç‡-17%ã€‚<br><br>
<em style="color: #718096;">å¾¡ç¤¾ã®æˆé•·ã‚’ã©ã®ã‚ˆã†ã«åŠ é€Ÿã§ãã‚‹ã‹ã€ä¸€åº¦ãŠè©±ã—ã—ã¾ã›ã‚“ã‹ï¼Ÿ</em>
                `,
                
                schedule: "æ‰¿çŸ¥ã—ã¾ã—ãŸã€‚ãƒ­ã‚¸ãƒ£ãƒ¼ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’é–‹ãã¾ã™ã€‚ã”éƒ½åˆã®è‰¯ã„æ—¥æ™‚ã‚’ãŠé¸ã³ãã ã•ã„ã€‚",
                resume: "ãƒ­ã‚¸ãƒ£ãƒ¼ã®å±¥æ­´æ›¸ã¯ã“ã¡ã‚‰ã§ã™ã€‚",
                linkedin: "LinkedInã§ã®ã”é€£çµ¡ã¯ã“ã¡ã‚‰ã‹ã‚‰: <a href='https://www.linkedin.com/in/meetrogergomes' target='_blank' style='color: #3182ce;'>linkedin.com/in/meetrogergomes</a>",
                formIntro: "ä»¥ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒ ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã”è¨˜å…¥ãã ã•ã„ã€‚",
                thanks: "ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚",
                error: "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚",
                ui: {
                    title: "Roger's AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ",
                    subtitle: "Enterprise Connect",
                    placeholder: "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›...",
                    buttons: ["ãƒãƒ£ãƒƒãƒˆã‚’äºˆç´„", "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ®‹ã™", "è·æ­´ãƒ»ã‚¹ã‚­ãƒ«æ¦‚è¦", "å±¥æ­´æ›¸ã‚’è¦‹ã‚‹", "è·å‹™çµŒæ­´æ›¸ã‚’è¦‹ã‚‹", "LinkedIn", "çµ‚äº†"],
                    form: { name: "ãŠåå‰", company: "ä¼šç¤¾å", email: "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹", msg: "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸", send: "é€ä¿¡" }
                },

                industryDisclaimer: "æ³¨æ„äº‹é …: ç§ã¯B2B SaaSãŠã‚ˆã³ãƒ†ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—(ã‚·ãƒ¼ãƒ‰ã‹ã‚‰ã‚·ãƒªãƒ¼ã‚ºC)ã‚’å°‚é–€ã¨ã—ã¦ã„ã¾ã™ã€‚",
                
                deepDiveIntro: "å¾¡ç¤¾ã®ä¸»è¦ãªã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³èª²é¡Œã«å¯¾ã™ã‚‹ã‚«ã‚¹ã‚¿ãƒ 90æ—¥é–“ãƒ—ãƒ¬ã‚¤ãƒ–ãƒƒã‚¯ã‚’ä½œæˆã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚ãƒ—ãƒ­ã‚»ã‚¹ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼š\n\nâ˜‘ ç§ãŒå„ãƒ—ãƒ¬ã‚¤ãƒ–ãƒƒã‚¯ã‚’å€‹åˆ¥ã«ä½œæˆ(AIãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãªã—)\nâ˜‘ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³: 48~72æ™‚é–“ä»¥å†…ã«ãƒ¡ãƒ¼ãƒ«é…ä¿¡\nâ˜‘ ç„¦ç‚¹: å¾¡ç¤¾ã®ä¸Šä½3ã¤ã®èª²é¡Œ(ä¸€ç·’ã«å„ªå…ˆé †ä½ã‚’æ±ºå®š)\nâ˜‘ æä¾›å†…å®¹: æˆ¦ç•¥çš„ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ— + å®Ÿè£…ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯\n\nâš ï¸ é‡è¦: ã“ã‚Œã¯å®Œå…¨ãªãƒ—ãƒ¬ã‚¤ãƒ–ãƒƒã‚¯ã§ã¯ãªãã€èª²é¡Œã«å¯¾ã™ã‚‹æ–¹å‘æ€§ã®ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã§ã™ã€‚ç„¡æ–™ã§å®Œå…¨ãªå®Ÿè£…è¨ˆç”»ã‚’æä¾›ã—ãŸã‚‰ã€èª°ã‚‚ç§ã‚’é›‡ã†å¿…è¦ãŒãªã„ã§ã™ã‚ˆã­ï¼Ÿã“ã‚Œã‚’æˆ¦ç•¥çš„ã‚³ãƒ³ã‚µãƒ«ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¨ãŠè€ƒãˆãã ã•ã„ã€‚\n\nã“ã‚Œã¯å³åº§ã®AIå‡ºåŠ›ã§ã¯ãªãã€æˆ¦ç•¥çš„æ€è€ƒã§ã™ã€‚ãŠå¾…ã¡ã„ãŸã ãä¾¡å€¤ãŒã‚ã‚Šã¾ã™ã€‚\n\nå¾¡ç¤¾ã®çŠ¶æ³ã‚’ç†è§£ã™ã‚‹ãŸã‚ã«ã€3~5ã¤ã»ã©è¿½åŠ è³ªå•ã‚’ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã—ã‚‡ã†ã‹?",
                
                deepDiveAccept: "ç´ æ™´ã‚‰ã—ã„! ã„ãã¤ã‹è³ªå•ã•ã›ã¦ãã ã•ã„ã€‚3åˆ†ã»ã©ã§çµ‚ã‚ã‚Šã¾ã™ã€‚",
                deepDiveSkip: "æ‰¿çŸ¥ã—ã¾ã—ãŸã€‚ã„ãŸã ã„ãŸæƒ…å ±ã‚’ã‚‚ã¨ã«ä½œæˆã„ãŸã—ã¾ã™ã€‚",
                priorityRankingQuestion: "æœ€å¾Œã®è³ªå•ã§ã™: ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³èª²é¡Œã‚’ç·Šæ€¥æ€§ã§ãƒ©ãƒ³ã‚¯ä»˜ã‘ã™ã‚‹å ´åˆã€ç¾åœ¨ã€åç›Šã€æ™‚é–“ã€ã¾ãŸã¯ãƒãƒ¼ãƒ ã®å£«æ°—ã®ç‚¹ã§æœ€ã‚‚ã‚³ã‚¹ãƒˆãŒã‹ã‹ã£ã¦ã„ã‚‹ã®ã¯ã©ã‚Œã§ã™ã‹?",
                priorityPlaceholder: 'ä¾‹:ã€Œã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ¼å‹ã¤ã¹ãæ¡ˆä»¶ã‚’å¤±ã£ã¦ã„ã‚‹ã€',
                diagnosticComplete: "å®Œç’§ã§ã™! å¾¡ç¤¾ã®çŠ¶æ³ã‚’å®Œå…¨ã«æŠŠæ¡ã—ã¾ã—ãŸã€‚è©³ç´°ãªãƒ—ãƒ¬ã‚¤ãƒ–ãƒƒã‚¯ã‚’ä½œæˆã—ã¾ã™:\n\nâ€¢ ç¬¬1~2é€±: è¨ºæ–­\nâ€¢ ç¬¬3~6é€±: ã‚¯ã‚¤ãƒƒã‚¯ã‚¦ã‚£ãƒ³\nâ€¢ ç¬¬7~12é€±: æˆ¦ç•¥çš„ã‚¤ãƒ‹ã‚·ã‚¢ãƒ†ã‚£ãƒ–\n\n48~72æ™‚é–“ä»¥å†…ã«ãƒ¡ãƒ¼ãƒ«ã§ãŠé€ã‚Šã—ã¾ã™ã€‚ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚",
                diagnosticConfirm: "æ‰¿çŸ¥ã—ã¾ã—ãŸ! 48~72æ™‚é–“ä»¥å†…ã« {email} å®›ã«ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ¬ã‚¤ãƒ–ãƒƒã‚¯ã‚’ãŠé€ã‚Šã—ã¾ã™ã€‚",
                acknowledgments: ['æ‰¿çŸ¥ã—ã¾ã—ãŸã€‚', 'ç†è§£ã—ã¾ã—ãŸã€‚', 'ãªã‚‹ã»ã©ã€‚', 'å‚è€ƒã«ãªã‚Šã¾ã™ã€‚', 'ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚'],
                diagnosticQuestions: {
                    'Operations': [
                        { id: 'ops_1', q: "ãƒãƒ¼ãƒ ãŒæœ€ã‚‚è‡ªå‹•åŒ–ã—ãŸã„ã¨è€ƒãˆã¦ã„ã‚‹æ‰‹ä½œæ¥­ã¯ä½•ã§ã™ã‹?", type: 'freeText', placeholder: 'ä¾‹:ã€ŒCRMã¨è«‹æ±‚ã‚·ã‚¹ãƒ†ãƒ é–“ã®ãƒ‡ãƒ¼ã‚¿ã‚³ãƒ”ãƒ¼ã€', followUps: { 'data entry': "æ‰¿çŸ¥ã—ã¾ã—ãŸã€‚ã“ã‚Œã¯CRMã€ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã€ãã®ä»–ã®ã©ã“ã§ç™ºç”Ÿã—ã¦ã„ã¾ã™ã‹?", 'reporting': "ãªã‚‹ã»ã©ã€‚ç¾åœ¨ã€ãƒ¬ãƒãƒ¼ãƒˆä½œæˆã«ã©ã®ãã‚‰ã„æ™‚é–“ãŒã‹ã‹ã£ã¦ã„ã¾ã™ã‹?", 'coordination': "å‚è€ƒã«ãªã‚Šã¾ã™ã€‚ã©ã®ãƒãƒ¼ãƒ ãŒæœ€ã‚‚é€£æºã«è‹¦åŠ´ã—ã¦ã„ã¾ã™ã‹?", 'default': "ç†è§£ã—ã¾ã—ãŸã€‚ç¾åœ¨ã€ã“ã‚Œã«å¯¾ã—ã¦ã©ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã‹?" } },
                        { id: 'ops_2', q: "ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä¸Šã®å•é¡ŒãŒç™ºç”Ÿã™ã‚‹å ´åˆã€é€šå¸¸ã©ã“ã§éšœå®³ãŒèµ·ãã¦ã„ã¾ã™ã‹?", type: 'options', options: ["è²¬ä»»ã®ä¸æ˜ç¢ºã•", "ãƒ„ãƒ¼ãƒ«ã®åˆ¶é™", "ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚®ãƒ£ãƒƒãƒ—", "ãƒ—ãƒ­ã‚»ã‚¹ãŒæ–‡æ›¸åŒ–ã•ã‚Œã¦ã„ãªã„"] },
                        { id: 'ops_3', q: "æ˜æ—¥1ã¤ã®ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³èª²é¡Œã‚’è§£æ±ºã§ãã‚‹ã¨ã—ãŸã‚‰ã€ãƒãƒ¼ãƒ ã®ç”Ÿç”£æ€§ã«æœ€ã‚‚å¤§ããªå½±éŸ¿ã‚’ä¸ãˆã‚‹ã‚‚ã®ã¯ä½•ã§ã™ã‹?", type: 'freeText', placeholder: 'ä¾‹:ã€Œé€±æ¬¡ã®æ‰‹å‹•ç…§åˆãƒ—ãƒ­ã‚»ã‚¹ã®æ’é™¤ã€' }
                    ],
                    'Conversion': [
                        { id: 'conv_1', q: "ã‚»ãƒ¼ãƒ«ã‚¹ãƒ—ãƒ­ã‚»ã‚¹ã®ã©ã®æ®µéšã§ãƒªãƒ¼ãƒ‰ãŒæœ€ã‚‚é›¢è„±ã—ã¾ã™ã‹?", type: 'options', options: ["åˆå›ã‚³ãƒ¼ãƒ«/ãƒ‡ãƒ¢", "ææ¡ˆ/ä¾¡æ ¼è¨­å®šæ®µéš", "å¥‘ç´„/æ³•å‹™", "ãƒ‡ãƒ¢å¾Œã«é€£çµ¡ãŒé€”çµ¶ãˆã‚‹"] },
                        { id: 'conv_2', q: "å–¶æ¥­ãƒãƒ¼ãƒ ãŒæœ€ã‚‚ã‚ˆãèãç•°è­°ã¯ä½•ã§ã™ã‹?", type: 'freeText', placeholder: 'ä¾‹:ã€Œç«¶åˆã¨æ¯”è¼ƒã—ã¦é«˜ã™ãã‚‹ã€', followUps: { 'price': "æ‰¿çŸ¥ã—ã¾ã—ãŸã€‚å®Ÿéš›ã®ä¾¡æ ¼è¨­å®šã¯ç«¶åˆã¨ã©ã®ã‚ˆã†ã«æ¯”è¼ƒã•ã‚Œã¾ã™ã‹?", 'timing': "å‚è€ƒã«ãªã‚Šã¾ã™ã€‚é€šå¸¸ã€ã€Œä»Šã¯ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã¯ãªã„ã€ã¨ã„ã†å›ç­”ã®ç†ç”±ã¯ä½•ã§ã™ã‹? äºˆç®—ã‚µã‚¤ã‚¯ãƒ«? ä»–ã®å„ªå…ˆäº‹é …?", 'value': "å‚è€ƒã«ãªã‚Šã¾ã™ã€‚è¦‹è¾¼ã¿å®¢ã¯å¾¡ç¤¾ã®ROIã‚’æ˜ç¢ºã«ç†è§£ã—ã¦ã„ã¾ã™ã‹ã€ãã‚Œã¨ã‚‚å•é¡Œã®ä¸€éƒ¨ã§ã™ã‹?", 'default': "ç†è§£ã—ã¾ã—ãŸã€‚ç¾åœ¨ã€ãƒãƒ¼ãƒ ã¯ãã®ç•°è­°ã«ã©ã®ã‚ˆã†ã«å¯¾å¿œã—ã¦ã„ã¾ã™ã‹?" } },
                        { id: 'conv_3', q: "æœ€ã‚‚æˆç´„ç‡ã®é«˜ã„å–¶æ¥­æ‹…å½“è€…ã¯ã€ä»–ã®äººã¨ä½•ãŒé•ã„ã¾ã™ã‹?", type: 'freeText', placeholder: 'ä¾‹:ã€Œå½¼å¥³ã¯ãƒ‡ãƒ¢ã®å‰ã«ã‚«ã‚¹ã‚¿ãƒ ROIè¨ˆç®—ãƒ„ãƒ¼ãƒ«ã‚’é€ä¿¡ã™ã‚‹ã€' }
                    ],
                    'Churn': [
                        { id: 'churn_1', q: "é¡§å®¢ã‚¸ãƒ£ãƒ¼ãƒ‹ãƒ¼ã®ã©ã®æ™‚ç‚¹ã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãŒæœ€ã‚‚å¤šãç™ºç”Ÿã—ã¾ã™ã‹?", type: 'options', options: ["æœ€åˆã®30æ—¥é–“(ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°)", "90~180æ—¥(ç«‹ã¡ä¸Šã’å¾Œ)", "æ›´æ–°æ™‚", "ã‚µãƒãƒ¼ãƒˆå•é¡Œã®å¾Œ"] },
                        { id: 'churn_2', q: "è§£ç´„ã—ãŸé¡§å®¢ã«ç†ç”±ã‚’å°‹ã­ãŸéš›ã€æœ€ã‚‚å¤šã„å›ç­”ã¯ä½•ã§ã™ã‹?", type: 'freeText', placeholder: 'ä¾‹:ã€Œã‚³ã‚¹ãƒˆã‚’æ­£å½“åŒ–ã™ã‚‹ã ã‘ã®ä¾¡å€¤ã‚’è¦‹å‡ºã›ãªã‹ã£ãŸã€', followUps: { 'didn\'t use': "ã‚ˆãã‚ã‚‹ã“ã¨ã§ã™ã€‚å°å…¥ã«è‹¦åŠ´ã—ãŸã®ã‹ã€ãã‚Œã¨ã‚‚ä½¿ç”¨ã‚±ãƒ¼ã‚¹ãŒæ¶ˆæ»…ã—ãŸã®ã§ã™ã‹?", 'expensive': "å‚è€ƒã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã¯äºˆç®—å‰Šæ¸›ã®å•é¡Œã§ã™ã‹ã€ãã‚Œã¨ã‚‚ååˆ†ãªROIãŒè¦‹ãˆãªã‹ã£ãŸã®ã§ã™ã‹?", 'competitor': "æ‰¿çŸ¥ã—ã¾ã—ãŸã€‚ç«¶åˆãŒæä¾›ã—ã¦ã„ã¦å¾¡ç¤¾ã«ã¯ãªã„ã‚‚ã®ã¯ä½•ã§ã—ãŸã‹?", 'default': "ç†è§£ã—ã¾ã—ãŸã€‚æœ€ã‚‚æº€è¶³ã—ã¦ã„ã‚‹é¡§å®¢ã«æ®‹ã‚‹ç†ç”±ã‚’å°‹ã­ãŸå ´åˆã€ä½•ã¨è¨€ã„ã¾ã™ã‹?" } },
                        { id: 'churn_3', q: "æœ€ã‚‚æˆåŠŸã—ã¦ã„ã‚‹é¡§å®¢ã«å…±é€šã™ã‚‹1ã¤ã®ç‰¹å¾´ã¯ä½•ã§ã™ã‹?", type: 'freeText', placeholder: 'ä¾‹:ã€Œå°å…¥ã‚’æ¨é€²ã™ã‚‹å°‚ä»»ã®ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³ãŒã„ã‚‹ã€' }
                    ],
                    'Velocity': [
                        { id: 'vel_1', q: "ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§æ¡ˆä»¶ãŒåœæ»ã™ã‚‹å…¸å‹çš„ãªç†ç”±ã¯ä½•ã§ã™ã‹?", type: 'options', options: ["æ³•å‹™/èª¿é”å¾…ã¡", "è¤‡æ•°ã®ã‚¹ãƒ†ãƒ¼ã‚¯ãƒ›ãƒ«ãƒ€ãƒ¼ã®èª¿æ•´ä¸è¶³", "å®Ÿè£…ã¸ã®æ‡¸å¿µ", "äºˆç®—æ‰¿èªã®é…å»¶"] },
                        { id: 'vel_2', q: "æœ€åˆã®æ¥è§¦ã‹ã‚‰ã‚¯ãƒ­ãƒ¼ã‚ºã¾ã§ã€å¹³å‡ã§ã©ã®ãã‚‰ã„ã®æœŸé–“ãŒã‹ã‹ã‚Šã¾ã™ã‹?", type: 'freeText', placeholder: 'ä¾‹:ã€Œç´„90æ—¥ã§ã™ãŒã€45æ—¥ã«è¿‘ã¥ã‘ãŸã„ã€', followUps: { '3': "æ‰¿çŸ¥ã—ã¾ã—ãŸã€‚é…å»¶ã¯å¾¡ç¤¾å´(å–¶æ¥­ãƒ—ãƒ­ã‚»ã‚¹)ã§ã™ã‹ã€ãã‚Œã¨ã‚‚é¡§å®¢å´(è³¼è²·ãƒ—ãƒ­ã‚»ã‚¹)ã§ã™ã‹?", '6': "ç†è§£ã—ã¾ã—ãŸã€‚ä¸€è²«ã—ã¦é•·å¼•ãç‰¹å®šã®æ®µéšã¯ã‚ã‚Šã¾ã™ã‹?", '9': "ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã¨ã—ã¦ç†è§£ã§ãã¾ã™ã€‚ãã®æœŸé–“ã‚’åŠåˆ†ã«ã™ã‚‹ã«ã¯ä½•ã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã‹?", 'default': "å‚è€ƒã«ãªã‚Šã¾ã™ã€‚ãã‚Œã‚’é€Ÿã‚ã‚‹ã«ã¯ä½•ã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã‹?" } },
                        { id: 'vel_3', q: "å–¶æ¥­ãƒ—ãƒ­ã‚»ã‚¹ã‹ã‚‰1ã¤ã®æ‘©æ“¦ç‚¹ã‚’å–ã‚Šé™¤ã‘ã‚‹ã¨ã—ãŸã‚‰ã€ä½•ãŒå³åº§ã«ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—ã—ã¾ã™ã‹?", type: 'freeText', placeholder: 'ä¾‹:ã€Œæ³•å‹™ãƒ¬ãƒ“ãƒ¥ãƒ¼å‰ã«æŠ€è¡“æ¤œè¨¼ã‚’å®Œäº†ã™ã‚‹ã€' }
                    ]
                }
            }
        };

        class CursorController {
            constructor() {
                this.dot = document.getElementById('cursorDot');
                this.outline = document.getElementById('cursorOutline');
                this.mouseX = window.innerWidth / 2;
                this.mouseY = window.innerHeight / 2;
                this.outlineX = this.mouseX;
                this.outlineY = this.mouseY;

                if (window.matchMedia("(hover: hover) and (pointer: fine)").matches) {
                    this.init();
                } else {
                    if (this.dot) this.dot.style.display = 'none';
                    if (this.outline) this.outline.style.display = 'none';
                }
            }

            init() {
                document.addEventListener('mousemove', (e) => {
                    this.mouseX = e.clientX;
                    this.mouseY = e.clientY;
                    this.dot.style.transform = `translate(${this.mouseX}px, ${this.mouseY}px) translate(-50%, -50%)`;
                });

                document.addEventListener('mousedown', () => {
                    this.outline.classList.add('clicking');
                    setTimeout(() => this.outline.classList.remove('clicking'), 400);
                });

                this.animate();
                this.addHoverListeners();
            }

            animate() {
                const speed = 0.15;
                this.outlineX += (this.mouseX - this.outlineX) * speed;
                this.outlineY += (this.mouseY - this.outlineY) * speed;
                this.outline.style.transform = `translate(${this.outlineX}px, ${this.outlineY}px) translate(-50%, -50%)`;
                requestAnimationFrame(() => this.animate());
            }

            addHoverListeners() {
                const interactives = document.querySelectorAll('a, button, input, textarea, .quick-reply, .language-button, .star');
                interactives.forEach(el => {
                    el.addEventListener('mouseenter', () => document.body.classList.add('hovering'));
                    el.addEventListener('mouseleave', () => document.body.classList.remove('hovering'));
                });
                
                const observer = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        if (mutation.addedNodes.length) {
                            mutation.addedNodes.forEach(node => {
                                if (node.nodeType === 1) {
                                    const newInteractives = node.matches && node.matches('button, .quick-reply') ? [node] : [];
                                    if (node.querySelectorAll) {
                                        newInteractives.push(...node.querySelectorAll('button, .quick-reply, a'));
                                    }
                                    newInteractives.forEach(el => {
                                        el.addEventListener('mouseenter', () => document.body.classList.add('hovering'));
                                        el.addEventListener('mouseleave', () => document.body.classList.remove('hovering'));
                                    });
                                }
                            });
                        }
                    });
                });
                observer.observe(document.body, { childList: true, subtree: true });
            }
        }

        class AI_Assistant {
            constructor() {
                this.lang = 'en';
                this.state = 'init';
                this.diagnosticState = { stage: null, bottleneck: null, burn: null };
                this.deepDiveState = { currentQuestionIndex: 0, answers: [], questionBank: null, inFollowUp: false };
                
                // Rate Limiting Cache (10 min window)
                this.submissionCache = { count: 0, resetTime: Date.now() + 600000 };
                
                this.dom = {
                    screens: { lang: document.getElementById('languageSelectionScreen'), chat: document.getElementById('chatContainer') },
                    messages: document.getElementById('chatMessages'),
                    inputArea: document.getElementById('inputArea'),
                    quickReplies: document.getElementById('quickReplies'),
                    input: document.getElementById('chatInput'),
                    form: document.getElementById('contactForm'),
                    typing: document.getElementById('typingIndicator'),
                    rating: document.getElementById('ratingSection'),
                    title: document.querySelector('.chat-title'),
                    subtitle: document.querySelector('.chat-subtitle')
                };

                this.bindEvents();
                this.cursor = new CursorController();
            }

            validateAnswer(answer, questionType, questionId) {
                const lowerAnswer = answer.toLowerCase().trim();
                const invalidPatterns = [
                    /^f+u+c+k+$/i, 
                    /^shit$/i, 
                    /^[^a-z0-9\s]{3,}$/i, 
                    /^(.)\1{4,}$/i, 
                    /^(lol|haha|wtf|idk|nope|meh)$/i
                ];
                
                for (let pattern of invalidPatterns) {
                    if (pattern.test(lowerAnswer)) {
                        return { valid: false, reason: 'inappropriate' };
                    }
                }
                
                if (questionType === 'freeText') {
                    if (answer.length < 3) {
                        return { valid: false, reason: 'too_short' };
                    }
                    if (questionId && (questionId.includes('ops_1') || questionId.includes('conv_2') || questionId.includes('priority'))) {
                        if (answer.split(' ').length < 2) {
                            return { valid: false, reason: 'too_vague' };
                        }
                    }
                }
                return { valid: true };
            }

            // ADDED: Helper to map Japanese bottleneck to English key
            mapBottleneckToEnglish(localizedAnswer) {
                const mapping = {
                    'ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³': 'Operations',
                    'ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³': 'Conversion',
                    'ãƒãƒ£ãƒ¼ãƒ³': 'Churn',
                    'ãƒ™ãƒ­ã‚·ãƒ†ã‚£': 'Velocity'
                };
                return mapping[localizedAnswer] || localizedAnswer;
            }

            bindEvents() {
                document.getElementById('sendBtn').onclick = () => this.handleUserInput();
                this.dom.input.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = (this.scrollHeight) + 'px';
                });
                this.dom.input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.handleUserInput();
                    }
                });
                document.getElementById('stars').addEventListener('click', (e) => {
                    if (e.target.tagName === 'SPAN') {
                        const rating = e.target.getAttribute('data-val');
                        this.handleRating(rating);
                    }
                });
            }

            setLanguage(selectedLang) {
                this.lang = selectedLang;
                const txt = RESOURCES[this.lang].ui;
                this.dom.title.textContent = txt.title;
                this.dom.subtitle.textContent = txt.subtitle;
                this.dom.input.placeholder = txt.placeholder;

                document.getElementById('lbl_name').textContent = txt.form.name;
                document.getElementById('lbl_company').textContent = txt.form.company;
                document.getElementById('lbl_email').textContent = txt.form.email;
                document.getElementById('lbl_msg').textContent = txt.form.msg;
                document.getElementById('btn_send').textContent = txt.form.send;

                this.dom.screens.lang.style.display = 'none';
                this.dom.screens.chat.style.display = 'flex';

                this.startConversation();
            }

            async startConversation() {
                await this.botType(RESOURCES[this.lang].welcome);
                await this.sleep(800);
                await this.botType(RESOURCES[this.lang].menuPrompt);
                this.showMainMenu();
            }

            showMainMenu() {
                const btns = RESOURCES[this.lang].ui.buttons;
                const container = this.dom.quickReplies;
                container.innerHTML = '';
                container.classList.remove('hidden');
                
                // Ensure main input is visible (restored after deep dive)
                const mainInputWrapper = document.querySelector('.input-wrapper');
                if (mainInputWrapper) {
                    mainInputWrapper.style.display = 'flex';
                }

                const createBtn = (text, type, action) => {
                    const btn = document.createElement('div');
                    btn.className = `quick-reply ${type}`;
                    btn.textContent = text;
                    btn.onclick = () => this.handleQuickReply(text, action);
                    return btn;
                };

                if (this.lang === 'en') {
                    container.appendChild(createBtn('Get Custom Playbook', 'primary', 'diagnostic'));
                    container.appendChild(createBtn(btns[0], 'primary', 'schedule'));
                    container.appendChild(createBtn(btns[1], 'secondary', 'message'));
                    container.appendChild(createBtn(btns[2], 'secondary', 'summary'));
                    container.appendChild(createBtn(btns[3], 'secondary', 'resume'));
                    container.appendChild(createBtn(btns[4], 'secondary', 'linkedin'));
                    container.appendChild(createBtn(btns[5], 'neutral', 'exit'));
                } else {
                    container.appendChild(createBtn('ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ¬ã‚¤ãƒ–ãƒƒã‚¯å–å¾—', 'primary', 'diagnostic'));
                    container.appendChild(createBtn(btns[0], 'primary', 'schedule'));
                    container.appendChild(createBtn(btns[1], 'secondary', 'message'));
                    container.appendChild(createBtn(btns[2], 'secondary', 'summary'));
                    container.appendChild(createBtn(btns[3], 'secondary', 'resume'));
                    container.appendChild(createBtn(btns[4], 'secondary', 'resume_detail'));
                    container.appendChild(createBtn(btns[5], 'secondary', 'linkedin'));
                    container.appendChild(createBtn(btns[6], 'neutral', 'exit'));
                }
            }

            handleQuickReply(text, action) {
                this.addMessage(text, 'user');
                this.dom.quickReplies.classList.add('hidden');
                this.processIntent(action);
            }

            handleUserInput() {
                const txt = this.dom.input.value.trim();
                if (!txt) return;
                
                this.addMessage(txt, 'user');
                this.dom.input.value = '';
                this.dom.input.style.height = 'auto';
                this.dom.quickReplies.classList.add('hidden');
                
                const lower = txt.toLowerCase();
                let action = 'default';
                
                if (lower.includes('schedule') || lower.includes('chat') || lower.includes('äºˆç´„')) action = 'schedule';
                else if (lower.includes('message') || lower.includes('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸')) action = 'message';
                else if (lower.includes('resume') || lower.includes('å±¥æ­´æ›¸')) action = 'resume';
                else if (lower.includes('summary') || lower.includes('æ¦‚è¦')) action = 'summary';
                else if (lower.includes('linkedin')) action = 'linkedin';
                else if (lower.includes('bye') || lower.includes('exit') || lower.includes('çµ‚äº†')) action = 'exit';

                this.processIntent(action);
            }

            async processIntent(action) {
                await this.sleep(500);

                switch(action) {
                    case 'diagnostic':
                        if (!this.diagnosticState.stage) {
                            await this.botType(this.lang === 'en' ? "Let me ask a few quick questions first to understand your context..." : "ã¾ãšã€å¾¡ç¤¾ã®çŠ¶æ³ã‚’ç†è§£ã™ã‚‹ãŸã‚ã«ã„ãã¤ã‹è³ªå•ã•ã›ã¦ãã ã•ã„...");
                            await this.sleep(800);
                            await this.askStage(); 
                        } else {
                            await this.startDeepDive();
                        }
                        break;
                    case 'schedule':
                        await this.botType(RESOURCES[this.lang].schedule);
                        window.open('https://calendly.com/gomes-roger333', '_blank');
                        this.showMainMenu(); 
                        break;
                    case 'message':
                        await this.botType(RESOURCES[this.lang].formIntro);
                        this.dom.inputArea.classList.add('hidden');
                        this.dom.form.classList.remove('hidden');
                        break;
                    case 'summary':
                        const summaryText = RESOURCES[this.lang].summary.replace(/\n/g, '<br>');
                        await this.botType(summaryText);
                        this.showMainMenu();
                        break;
                    case 'resume':
                        await this.botType(RESOURCES[this.lang].resume);
                        const resumeUrl = this.lang === 'ja' 
                            // Updated: Japanese Resume / Shokumu Keireki (Link #2)
                            ? 'https://drive.google.com/file/d/1iFvsfMgdqXnjrpugfVnyV8iysjNw-zJG/preview' 
                            // Updated: English Resume (Link #1)
                            : 'https://drive.google.com/file/d/1j88QF-g-sASNpYuwVVIZv0H81VfN1EVx/preview';
                        this.embedIframe(resumeUrl);
                        this.showMainMenu();
                        break;
                    case 'resume_detail':
                        await this.botType("æ‰¿çŸ¥ã„ãŸã—ã¾ã—ãŸã€‚ãƒ­ã‚¸ãƒ£ãƒ¼ã®è·å‹™çµŒæ­´æ›¸ã§ã™ã€‚");
                        // Updated: Japanese Shokumu Keirekisho (Link #3)
                        this.embedIframe('https://drive.google.com/file/d/1azxPSOHcRYWICWJgYyqdyC_6rLmYSQO9/preview');
                        this.showMainMenu();
                        break;
                    case 'linkedin':
                        await this.botType(RESOURCES[this.lang].linkedin);
                        this.showMainMenu();
                        break;
                    case 'exit':
                        this.dom.inputArea.classList.add('hidden');
                        this.dom.quickReplies.classList.add('hidden');
                        this.dom.rating.classList.remove('hidden');
                        break;
                    default:
                        await this.botType(this.lang === 'en' ? "I'm not sure I understand. Could you pick an option?" : "ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ã€ç†è§£ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‹ã‚‰é¸ã‚“ã§ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿ");
                        this.showMainMenu();
                }
            }

            async askStage() {
                const question = this.lang === 'en' ? "What stage is your company currently in?" : "ç¾åœ¨ã®ä¼šç¤¾ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¯ã©ã“ã§ã™ã‹ï¼Ÿ";
                await this.botType(question);
                this.showQuickReplies(
                    this.lang === 'en' 
                    ? ['Seed', 'Series A', 'Series B', 'Series C', 'Bootstrap/Other'] 
                    : ['ã‚·ãƒ¼ãƒ‰', 'ã‚·ãƒªãƒ¼ã‚ºA', 'ã‚·ãƒªãƒ¼ã‚ºB', 'ã‚·ãƒªãƒ¼ã‚ºC', 'ãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—/ãã®ä»–']
                , 'stage');
            }

            // UPDATED: FIXED BUG #3 - Added Japanese translations
            async askBottleneck() {
                const question = this.lang === 'en' 
                    ? "What is your primary growth bottleneck right now?" 
                    : "ç¾åœ¨ã€æˆé•·ã®ä¸»ãªãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã¯ä½•ã§ã™ã‹ï¼Ÿ";
                
                await this.botType(question);
                
                this.showQuickReplies(
                    this.lang === 'en' 
                    ? ['Operations', 'Conversion', 'Churn', 'Velocity'] 
                    : ['ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³', 'ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³', 'ãƒãƒ£ãƒ¼ãƒ³', 'ãƒ™ãƒ­ã‚·ãƒ†ã‚£']
                , 'bottleneck');
            }

            async askBurn() {
                const question = this.lang === 'en' ? "What is your approximate monthly burn rate?" : "ãŠãŠã‚ˆãã®æœˆæ¬¡ãƒãƒ¼ãƒ³ãƒ¬ãƒ¼ãƒˆã¯ã©ã®ãã‚‰ã„ã§ã™ã‹ï¼Ÿ";
                await this.botType(question);
                this.showQuickReplies(
                    this.lang === 'en' 
                    ? ['<$50k', '$50k-$200k', '$200k+'] 
                    : ['5ä¸‡ãƒ‰ãƒ«æœªæº€', '5ä¸‡ã€œ20ä¸‡ãƒ‰ãƒ«', '20ä¸‡ãƒ‰ãƒ«ä»¥ä¸Š']
                , 'burn');
            }

            showQuickReplies(options, context) {
                const container = this.dom.quickReplies;
                container.innerHTML = '';
                options.forEach(option => {
                    const btn = document.createElement('div');
                    btn.className = 'quick-reply secondary';
                    btn.textContent = option;
                    btn.onclick = () => this.handleDiagnosticAnswer(option, context);
                    container.appendChild(btn);
                });
                container.classList.remove('hidden');
            }

            // UPDATED: Added mapping for localized answers
            async handleDiagnosticAnswer(answer, context) {
                this.addMessage(answer, 'user');
                this.dom.quickReplies.classList.add('hidden');
                
                if (context === 'stage') {
                    this.diagnosticState.stage = answer;
                    await this.sleep(500);
                    await this.askBottleneck();
                } else if (context === 'bottleneck') {
                    // Map Japanese answer to English key
                    this.diagnosticState.bottleneck = this.mapBottleneckToEnglish(answer);
                    await this.sleep(500);
                    await this.askBurn();
                } else if (context === 'burn') {
                    this.diagnosticState.burn = answer;
                    await this.generatePlaybook();
                }
            }

            async generatePlaybook() {
                await this.botType(RESOURCES[this.lang].industryDisclaimer);
                await this.sleep(1200);
                await this.startDeepDive();
            }

            async startDeepDive() {
                const intro = RESOURCES[this.lang].deepDiveIntro.replace(/\n/g, '<br>');
                await this.botType(intro);
                await this.sleep(1000);

                const container = this.dom.quickReplies;
                container.innerHTML = '';
                const options = this.lang === 'en' ? ['Yes, let\'s dig deeper', 'Skip to playbook'] : ['ã¯ã„ã€è©³ã—ãèã„ã¦ãã ã•ã„', 'ãƒ—ãƒ¬ã‚¤ãƒ–ãƒƒã‚¯ä½œæˆã¸é€²ã‚€'];

                options.forEach(option => {
                    const btn = document.createElement('div');
                    btn.className = 'quick-reply secondary';
                    btn.textContent = option;
                    btn.onclick = () => this.handleDeepDiveChoice(option);
                    container.appendChild(btn);
                });
                container.classList.remove('hidden');
            }

            async handleDeepDiveChoice(choice) {
                this.addMessage(choice, 'user');
                this.dom.quickReplies.classList.add('hidden');

                if (choice.includes('Skip') || choice.includes('é€²ã‚€')) {
                    await this.botType(RESOURCES[this.lang].deepDiveSkip);
                    await this.sleep(800);
                    await this.completeDeepDive();
                    return;
                }

                await this.botType(RESOURCES[this.lang].deepDiveAccept);
                await this.sleep(800);

                const bottleneckKey = this.diagnosticState.bottleneck; 
                this.deepDiveState.questionBank = RESOURCES[this.lang].diagnosticQuestions[bottleneckKey];
                
                if (!this.deepDiveState.questionBank) {
                    this.deepDiveState.questionBank = RESOURCES[this.lang].diagnosticQuestions['Operations'];
                }

                this.deepDiveState.currentQuestionIndex = 0;
                this.deepDiveState.answers = [];
                
                await this.askDeepDiveQuestion();
            }

            async askDeepDiveQuestion() {
                const currentQ = this.deepDiveState.questionBank[this.deepDiveState.currentQuestionIndex];

                // FIX: Restore main input if it was hidden
                const mainInputWrapper = document.querySelector('.input-wrapper');
                if (mainInputWrapper && mainInputWrapper.style.display === 'none') {
                    mainInputWrapper.style.display = 'flex';
                }

                if (!currentQ) {
                    await this.askPriorityRanking();
                    return;
                }

                const totalQuestions = this.deepDiveState.questionBank.length;
                const currentNum = this.deepDiveState.currentQuestionIndex + 1;
                const progress = this.lang === 'en' ? `[Question ${currentNum} of ${totalQuestions}]` : `[è³ªå• ${currentNum}/${totalQuestions}]`;

                await this.botType(`${progress}\n\n${currentQ.q}`);
                await this.sleep(500);

                if (currentQ.type === 'options') {
                    this.showDeepDiveOptions(currentQ.options);
                } else if (currentQ.type === 'freeText') {
                    this.showFreeTextInput(currentQ.placeholder);
                }
            }

            showDeepDiveOptions(options) {
                const container = this.dom.quickReplies;
                container.innerHTML = '';
                options.forEach(option => {
                    const btn = document.createElement('div');
                    btn.className = 'quick-reply secondary';
                    btn.textContent = option;
                    btn.onclick = () => this.handleDeepDiveAnswer(option, 'option');
                    container.appendChild(btn);
                });
                container.classList.remove('hidden');
            }

            // UPDATED: Fix Double Input Boxes
            showFreeTextInput(placeholderText = null) {
                const container = this.dom.quickReplies;
                container.innerHTML = '';
                
                // ADD THIS: Hide the main input wrapper during deep dive questions
                const mainInputWrapper = document.querySelector('.input-wrapper');
                if (mainInputWrapper) {
                    mainInputWrapper.style.display = 'none';
                }
                
                const wrapper = document.createElement('div');
                wrapper.style.cssText = 'display: flex; gap: 10px; width: 100%; align-items: flex-end;';
                
                const textarea = document.createElement('textarea');
                textarea.id = 'deepDiveAnswer';
                textarea.placeholder = placeholderText || (this.lang === 'en' ? 'Type your answer...' : 'ã”å›ç­”ã‚’å…¥åŠ›...');
                textarea.className = 'form-input';
                textarea.rows = 2;
                textarea.style.cssText = 'flex: 1; padding: 12px; border-radius: 8px; border: 1px solid #e2e8f0; resize: vertical;';
                
                const btn = document.createElement('button');
                btn.textContent = this.lang === 'en' ? 'Next' : 'æ¬¡ã¸';
                btn.className = 'btn-block btn-primary';
                btn.style.cssText = 'padding: 12px 24px; border-radius: 8px; white-space: nowrap; width: auto; height: fit-content;';
                
                btn.onclick = () => {
                    const answer = textarea.value.trim();
                    if (answer) {
                        this.handleDeepDiveAnswer(answer, 'freeText');
                    } else {
                        alert(this.lang === 'en' ? 'Please enter an answer' : 'å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    }
                };

                wrapper.appendChild(textarea);
                wrapper.appendChild(btn);
                container.appendChild(wrapper);
                container.classList.remove('hidden');
                setTimeout(() => textarea.focus(), 100);
            }

            // UPDATED: Critical Fix for Validation Logic
            async handleDeepDiveAnswer(answer, type) {
                const currentQ = this.deepDiveState.currentQuestionIndex < this.deepDiveState.questionBank.length 
                    ? this.deepDiveState.questionBank[this.deepDiveState.currentQuestionIndex]
                    : this.deepDiveState.priorityQuestion;

                // VALIDATE FIRST - BEFORE doing anything else
                const validation = this.validateAnswer(answer, type, currentQ ? currentQ.id : null);
                
                if (!validation.valid) {
                    // DON'T add user message
                    // DON'T hide buttons
                    let errorMsg;
                    if (validation.reason === 'inappropriate') {
                        errorMsg = this.lang === 'en' 
                            ? "I appreciate your candor, but I need a thoughtful response to create a useful playbook. Let's try that again?" 
                            : "ç‡ç›´ãªã”æ„è¦‹ã¯ã‚ã‚ŠãŒãŸã„ã§ã™ãŒã€æœ‰ç”¨ãªãƒ—ãƒ¬ã‚¤ãƒ–ãƒƒã‚¯ã‚’ä½œæˆã™ã‚‹ã«ã¯çœŸå‰£ãªå›ç­”ãŒå¿…è¦ã§ã™ã€‚ã‚‚ã†ä¸€åº¦ãŠé¡˜ã„ã§ãã¾ã™ã‹ï¼Ÿ";
                    } else if (validation.reason === 'too_short') {
                        errorMsg = this.lang === 'en'
                            ? "Could you elaborate a bit more? I need more context to give you meaningful recommendations."
                            : "ã‚‚ã†å°‘ã—è©³ã—ãèª¬æ˜ã—ã¦ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿæœ‰æ„ç¾©ãªææ¡ˆã‚’ã™ã‚‹ã«ã¯ã€ã‚ˆã‚Šå¤šãã®æ–‡è„ˆãŒå¿…è¦ã§ã™ã€‚";
                    } else { // too_vague
                        errorMsg = this.lang === 'en'
                            ? "I need a bit more detail here. For example, describe the specific situation or challenge you're facing."
                            : "ã‚‚ã†å°‘ã—è©³ç´°ãŒå¿…è¦ã§ã™ã€‚ä¾‹ãˆã°ã€ç›´é¢ã—ã¦ã„ã‚‹å…·ä½“çš„ãªçŠ¶æ³ã‚„èª²é¡Œã‚’èª¬æ˜ã—ã¦ãã ã•ã„ã€‚";
                    }
                    
                    await this.botType(errorMsg);
                    await this.sleep(800);
                    
                    // Re-show the SAME question input with context awareness
                    if (type === 'freeText' || (currentQ && currentQ.type === 'freeText')) {
                        // UX FIX: If in follow-up, don't show original placeholder
                        const placeholder = this.deepDiveState.inFollowUp ? null : currentQ.placeholder;
                        this.showFreeTextInput(placeholder);
                    } else if (currentQ) {
                        this.showDeepDiveOptions(currentQ.options);
                    }
                    return; // CRITICAL: Stop execution here completely
                }

                // ONLY proceed if validation passed
                this.addMessage(answer, 'user');
                this.dom.quickReplies.classList.add('hidden');

                // Handle "I don't know" gracefully
                if (type === 'freeText') {
                    const lowerAnswer = answer.toLowerCase();
                    if (lowerAnswer === 'idk' || lowerAnswer === 'not sure' || lowerAnswer === 'ã‚ã‹ã‚‰ãªã„' || lowerAnswer === 'skip') {
                        await this.sleep(500);
                        await this.botType(this.lang === 'en' ? "No worries! Let's move to the next question." : "å•é¡Œã‚ã‚Šã¾ã›ã‚“ï¼æ¬¡ã®è³ªå•ã«é€²ã¿ã¾ã—ã‚‡ã†ã€‚");
                        this.deepDiveState.currentQuestionIndex++;
                        await this.sleep(800);
                        await this.askDeepDiveQuestion();
                        return;
                    }
                }

                // Store answer
                this.deepDiveState.answers.push({
                    questionId: currentQ.id,
                    question: currentQ.q || currentQ.question,
                    answer: answer,
                    type: type
                });

                await this.sleep(500);

                // Check if this was the priority question
                if (currentQ.id === 'priority') {
                    const acks = RESOURCES[this.lang].acknowledgments;
                    await this.botType(acks[Math.floor(Math.random() * acks.length)]);
                    await this.sleep(800);
                    await this.completeDeepDive();
                    return;
                }

                // CRITICAL FIX: Only check for follow-ups if NOT already in a follow-up
                // AND if this is a valid freeText answer to the main question
                if (currentQ.followUps && type === 'freeText' && !this.deepDiveState.inFollowUp) {
                    const followUpText = this.findFollowUp(answer, currentQ.followUps);
                    if (followUpText) {
                        this.deepDiveState.inFollowUp = true;
                        await this.botType(followUpText);
                        await this.sleep(500);
                        this.showFreeTextInput(); // No placeholder, it's a follow-up
                        return; // Stop here, wait for follow-up answer
                    }
                }

                // Reset follow-up flag
                this.deepDiveState.inFollowUp = false;

                // Random acknowledgment
                const acks = RESOURCES[this.lang].acknowledgments;
                await this.botType(acks[Math.floor(Math.random() * acks.length)]);
                await this.sleep(800);

                // Move to next question
                this.deepDiveState.currentQuestionIndex++;
                await this.askDeepDiveQuestion();
            }

            findFollowUp(answer, followUps) {
                const lowerAnswer = answer.toLowerCase();
                for (const [keyword, followUpText] of Object.entries(followUps)) {
                    if (keyword !== 'default' && lowerAnswer.includes(keyword.toLowerCase())) {
                        return followUpText;
                    }
                }
                return followUps.default ? followUps.default : null;
            }

            async askPriorityRanking() {
                this.deepDiveState.priorityQuestion = {
                    id: 'priority',
                    question: RESOURCES[this.lang].priorityRankingQuestion,
                    q: RESOURCES[this.lang].priorityRankingQuestion
                };
                await this.botType(RESOURCES[this.lang].priorityRankingQuestion);
                await this.sleep(500);
                this.showFreeTextInput(RESOURCES[this.lang].priorityPlaceholder);
            }

            async completeDeepDive() {
                await this.botType(RESOURCES[this.lang].diagnosticComplete);
                await this.sleep(1000);
                this.showEmailCapture();
            }

            showEmailCapture() {
                const container = this.dom.quickReplies;
                container.innerHTML = '';
                
                const wrapper = document.createElement('div');
                wrapper.style.cssText = 'display: flex; gap: 10px; width: 100%; align-items: center;';
                
                const input = document.createElement('input');
                input.type = 'email';
                input.id = 'diagnosticEmail';
                input.placeholder = this.lang === 'en' ? 'your@email.com' : 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹';
                input.className = 'form-input';
                input.style.cssText = 'flex: 1; padding: 12px; border-radius: 8px; border: 1px solid #e2e8f0;';
                
                const btn = document.createElement('button');
                btn.textContent = this.lang === 'en' ? 'Submit' : 'é€ä¿¡';
                btn.className = 'btn-block btn-primary';
                btn.style.cssText = 'padding: 12px 24px; border-radius: 8px; white-space: nowrap; width: auto;';
                btn.onclick = () => this.submitDiagnosticRequest();
                
                wrapper.appendChild(input);
                wrapper.appendChild(btn);
                container.appendChild(wrapper);
                container.classList.remove('hidden');
                setTimeout(() => input.focus(), 100);
            }

            async submitDiagnosticRequest() {
                const emailInput = document.getElementById('diagnosticEmail');
                const email = emailInput ? emailInput.value.trim() : '';
                
                if (!email || !email.includes('@')) {
                    alert(this.lang === 'en' ? 'Please enter a valid email address' : 'æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }

                this.dom.quickReplies.classList.add('hidden');
                await this.botType(this.lang === 'en' ? 'Submitting request...' : 'ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ä¸­...');

                try {
                    // ADDED: Generate token for diagnostic requests too
                    const { token, timestamp } = this.generateRequestToken();

                    const requestData = {
                        type: 'diagnostic_playbook_request',
                        email: email,
                        timestamp: new Date().toISOString(),
                        language: this.lang,
                        diagnosticData: {
                            stage: this.diagnosticState.stage,
                            bottleneck: this.diagnosticState.bottleneck,
                            burn: this.diagnosticState.burn
                        },
                        deepDiveAnswers: this.deepDiveState.answers,
                        userAgent: navigator.userAgent,
                        referrer: document.referrer || 'direct',
                        _token: token,      // ADDED
                        _ts: timestamp      // ADDED
                    };

                    await fetch(GOOGLE_APPS_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(requestData)
                    });

                    const confirmMsg = RESOURCES[this.lang].diagnosticConfirm.replace('{email}', email);
                    await this.botType(confirmMsg);
                    await this.sleep(1000);
                    this.showMainMenu();

                } catch (error) {
                    console.error('Diagnostic request failed:', error);
                    await this.botType(this.lang === 'en' ? 'I encountered an issue submitting your request.' : 'ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®é€ä¿¡ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
                    this.showMainMenu();
                }
            }

            // ADDED: Input Sanitization Helper
            sanitizeHTML(text) {
                const div = document.createElement('div');
                div.textContent = text; // This escapes HTML automatically
                return div.innerHTML;
            }

            // UPDATED: Use sanitizeHTML for user inputs
            addMessage(text, sender) {
                const div = document.createElement('div');
                div.className = `message ${sender}`;
                
                // Only sanitize USER messages, not bot messages
                if (sender === 'user') {
                    div.textContent = text; // Safe - no HTML rendering
                } else {
                    div.innerHTML = text; // Bot messages can have formatted content
                }
                
                const time = document.createElement('span');
                time.className = 'message-time';
                time.innerText = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                div.appendChild(time);
                this.dom.messages.appendChild(div);
                this.scrollToBottom();
            }

            async botType(text) {
                this.dom.typing.style.display = 'block';
                this.scrollToBottom();
                const delay = Math.min(Math.max(text.length * 15, 800), 2000);
                await this.sleep(delay);
                this.dom.typing.style.display = 'none';
                this.addMessage(text, 'bot');
            }

            embedIframe(url) {
                const iframe = document.createElement('iframe');
                iframe.src = url;
                iframe.className = 'resume-frame';
                this.dom.messages.appendChild(iframe);
                this.scrollToBottom();
            }

            scrollToBottom() {
                this.dom.messages.scrollTop = this.dom.messages.scrollHeight;
            }

            sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

            // ADDED: Request Signing Helper
            generateRequestToken() {
                const timestamp = Date.now();
                const random = Math.random().toString(36).substring(7);
                // Simple hash - not cryptographically secure, but better than nothing
                const token = btoa(`${timestamp}-${random}-${navigator.userAgent.substring(0, 20)}`);
                return { token, timestamp };
            }

            async submitForm() {
                const btn = document.getElementById('btn_send');
                const status = document.getElementById('formStatus');

                // ADDED: Rate limit check
                if (Date.now() > this.submissionCache.resetTime) {
                    this.submissionCache = { count: 0, resetTime: Date.now() + 600000 };
                }
                
                if (this.submissionCache.count >= 3) {
                    alert(this.lang === 'en' 
                        ? 'Too many submissions. Please wait 10 minutes.' 
                        : 'é€ä¿¡å›æ•°ãŒå¤šã™ãã¾ã™ã€‚10åˆ†å¾Œã«å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚');
                    return;
                }

                this.submissionCache.count++;
                
                // ADDED: Request Signing
                const { token, timestamp } = this.generateRequestToken();

                const data = {
                    name: document.getElementById('f_name').value,
                    company: document.getElementById('f_company').value,
                    email: document.getElementById('f_email').value,
                    message: document.getElementById('f_message').value,
                    website: document.getElementById('website').value, // ADDED: Honeypot field
                    _token: token, // ADDED: Token
                    _ts: timestamp  // ADDED: Timestamp
                };

                // ADDED: Client-side honeypot check
                if (data.website) {
                    console.log('Bot detected');
                    status.innerText = RESOURCES[this.lang].thanks; // Fake success
                    return; // Don't actually submit
                }

                if (!data.name || !data.email || !data.message) {
                    alert(this.lang === 'en' ? "Please fill in required fields." : "å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
                    return;
                }

                btn.disabled = true;
                btn.innerText = "Sending...";

                try {
                    await fetch(GOOGLE_APPS_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    
                    status.innerText = RESOURCES[this.lang].thanks;
                    await this.sleep(1500);
                    this.dom.form.classList.add('hidden');
                    this.dom.rating.classList.remove('hidden');

                } catch (e) {
                    console.error(e);
                    btn.innerText = "Error";
                    status.innerText = RESOURCES[this.lang].error;
                    btn.disabled = false;
                }
            }
            
            handleRating(val) {
                this.dom.rating.innerHTML = `<p style="color:green; padding: 20px;">${this.lang === 'en' ? "Thank you!" : "ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼"}</p>`;
                setTimeout(() => {
                    document.body.innerHTML = `<div style="color: #4a5568; text-align: center;">
                        <h2>${this.lang === 'en' ? "Session Ended" : "ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†"}</h2>
                        <p>You can close this tab now.</p>
                    </div>`;
                }, 2000);
            }
        }

        const app = new AI_Assistant();

    </script>
</body>
</html>
